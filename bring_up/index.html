<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Bring Up - Notes</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Bring Up";
        var mkdocs_page_input_path = "bring_up.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> Notes
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Architecture</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../network/">Network</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../keys/">Key Management</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Guides</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../ansible/">Ansible</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Bring Up</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#install-os">Install OS</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#execute-playbook">Execute Playbook</a>
    </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Tools</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../raid/">RAID</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../borg/">Borg</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../rclone/">RClone</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../kvm/">KVM</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Services</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../pihole/">PiHole</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">Notes</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Guides</li>
      <li class="breadcrumb-item active">Bring Up</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="server-installation">Server Installation</h1>
<p>The following page describes the process for recreating a server
with the documented architecture using the tools configured within
the environment. The process of rebuilding the server will change
based on if a lighthouse or the primary container host is being
rebuilt.</p>
<p>In general, the process can be outlined as follows:</p>
<ol>
<li>Install OS - Typically a Ubuntu Server OS (LTS Edition)</li>
<li>Ansible Host - Prepare the ansible host to support rebuild</li>
<li>Execute Playbook - Run pre-built playbook on new server</li>
<li>File-system Encryption - Login and enable file-system level protections</li>
<li>Enable Nebula - Login to the server and enable nebula connectivity service</li>
<li>Unlock RAIDs - RAIDs will need to be unlocked to provide services with data</li>
<li>Start Services - Login to the server and start appropriate containerized services</li>
<li>Update DNS (if necessary) - Update DNS records if necessary for clients</li>
<li>Borg Backup Keys - Install wrapped borg keys on system so that automated backups are possible</li>
</ol>
<h2 id="install-os">Install OS</h2>
<p>As of now, the choice for servers is Ubuntu Server LTS. At the time of this writing, the
version that was installed with 24.04 LTS. The LTS versions were chosen for their
extended period of support.</p>
<p>The ISOs can be downloaded from <a href="https://ubuntu.com/download/server">here</a>. Then, the
ISO should be installed on a bootable USB to support load into the system. The process
will obviously be different than this for cases where cloud hosted services
or virtual machines are being utilized.</p>
<p>The following settings should be utilized during installation</p>
<ol>
<li>Minimized Install</li>
<li>Enable OpenSSH</li>
<li>Memorable Username and Password</li>
<li>Enable Full Disk Encryption (Optional)</li>
</ol>
<p>Once the installation has completed, make note of the ip address of the machine. This will be needed
during next step for ansible.</p>
<pre><code class="language-bash">ip addr
</code></pre>
<h2 id="execute-playbook">Execute Playbook</h2>
<p>Once OS is installed, the machine is ready to be bootstrapped and subsequently configured. This
configuration is completed through a series of ansible playbooks that are resident <a href="https://github.com/clwhipp/ansible">here</a>.</p>
<p>The first likely step is that the host variable files are likely not correct from perspective
of the IP address. The <strong>ansible_host</strong> variable needs to be updated within the appropriate
host variable file. This enables ansible to find the machine it's configuring.</p>
<p>Next, the desired playbook for setting up the machine needs to be validated to ensure that
it's looking at the appropriate host. For this walkthrough, I validated that <a href="https://github.com/clwhipp/ansible/blob/main/setup-all-in-one.yml">setup-all-in-one.yaml</a>
is indeed pointing at the appropriate host. If the hosts is incorrect, the changes will be made
to the incorrect machine.</p>
<pre><code class="language-yaml">- hosts: nexus
  become: true
</code></pre>
<p>Next, the Bitwarden CLI account needs to be unlocked to make secrets available
to ansible. This can be done using <a href="https://github.com/clwhipp/yubikey-utils/blob/main/ykbw">ykbw</a>
which is a custom built python application to enable unlocking a bitwarden
vault using a yubikey with hmac-sha1.</p>
<pre><code class="language-bash">ykbw unlock
</code></pre>
<p>When prompted, tap the yubikey to allow use of it's secret for unlocking the vault. The success
of the previous unlock can be verified with <strong>bw status</strong>. With the vault unlocked, its now
time to kick off the bootstrapping process.</p>
<p>The bootstrapping process will run the server through some preliminary steps to get it
in state where the more in depth playbooks can be ran. For instance, it will go through
and setup SSH keys, reset account passwords, and many other things.</p>
<p>The following command will kick off the bootstrap process and then run the specified
playbook. The script will prompt for the current machine password as a means to login
and get it changed.</p>
<pre><code class="language-bash">./bootstrap-host.sh &lt;name of playbook&gt; &lt;machine&gt;

ex.
./bootstrap-host.sh setup-all-in-one.yml nexus
</code></pre>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../ansible/" class="btn btn-neutral float-left" title="Ansible"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../raid/" class="btn btn-neutral float-right" title="RAID">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../ansible/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../raid/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
